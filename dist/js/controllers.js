angular.module("registry.controllers",[]).controller("SessionController",["$scope","$rootScope","$location","API",function(e,o,t,r){e.logged=!1,r.getUser().success(function(t,r,n,i){o.logged=!0,o.user=t.username,e.logged=!0,e.user=t.username,e.photo=t._json.avatar_url}).error(function(o,t,r,n){e.err=!0}),e.signin=function(e){r.signin(e)},e.logout=function(){r.logout().success(function(e,o,t,r){window.location.href="/registry"}).error(function(o,t,r,n){e.err=!0})},e.getClass=function(e){return t.path().substr(0,e.length)==e?"selected":""}}]).controller("FavController",function(e,o,t){e.favoriteList=[],o.logged&&(e.user=o.user,e.logged=o.logged,t.checkFav().success(function(o,t,r,n){e.favoriteList=o}).error(function(o,t,r,n){e.err=!0})),e.increment=function(e){o.logged&&(e.stars=e.stars+1)},e.toggleStatus=function(o){t.favFile(o._id).success(function(t,r,n,i){e.logged&&e.favoriteList.push(o._id)}).error(function(o,t,r,n){e.err=!0})},e.unToggleStatus=function(o){t.unFavFile(o._id).success(function(t,r,n,i){if(e.logged){var c=e.favoriteList.indexOf(o._id);e.favoriteList.splice(c,1)}}).error(function(o,t,r,n){e.err=!0})},e.isSelected=function(o){return e.favoriteList.indexOf(o._id)>-1}}).controller("MainController",function(e,o,t){e.search=function(){""!==this.data.search&&(o.localStorage.search=this.data.search,window.location.href="/registry")},e.goTo=function(e){window.location.href="/registry"},e.signin=function(e){t.signin(e)}}).controller("MyStackController",function(e,o){e.logged=!0,o.getUserFiles().success(function(o,t,r,n){e.files=o,e.loaded=!0}).error(function(o,t,r,n){e.err=!0,e.loaded=!0}),e.deploy=function(e){window.location.href="/api/v1/deploy/"+e},e.showModal=!1,e.toggleModal=function(){e.showModal=!e.showModal},e.generateEmbed=function(o){e.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+o+'.js"></script>'},e.searchFile=function(){var t=this.data.search;o.searchFile(t).success(function(o,t,r,n){e.results=o}).error(function(o,t,r,n){e.err=!0})}}).controller("FavoriteController",function(e,o,t){o.logged&&(e.logged=o.logged),t.getUserFavorites().success(function(o,t,r,n){e.files=o,e.loaded=!0}).error(function(o,t,r,n){e.err=!0,e.loaded=!0}),e.deploy=function(e){window.location.href="/api/v1/deploy/"+e},e.showModal=!1,e.toggleModal=function(){e.showModal=!e.showModal},e.generateEmbed=function(o){e.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+o+'.js"></script>'},e.removeRow=function(o){for(var t=-1,r=0;r<e.files.length;r++)if(e.files[r]._id===o._id){t=r;break}-1===t&&alert("Oops something went wrong"),e.files.splice(t,1)},e.searchFile=function(){var o=this.data.search;t.searchFile(o).success(function(o,t,r,n){e.results=o}).error(function(o,t,r,n){e.err=!0})}}).controller("RegistryController",function(e,o,t,r,n){e.files=new n,o.logged===!0?(r.checkFav().success(function(o,t,r,n){e.favoriteList=o,e.loaded=!0}).error(function(o,t,r,n){e.err=!0}),e.logged=!0):e.loaded=!0,e.showModal=!1,e.toggleModal=function(){e.copyText={status:"notClicked"},e.showModal=!e.showModal},e.generateEmbed=function(o){e.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+o+'.js"></script>'},e.deploy=function(e){window.location.href="/api/v1/deploy/"+e},e.searchFile=function(){var o=this.data.search;r.searchFile(o).success(function(o,t,r,n){e.results=o}).error(function(o,t,r,n){e.err=!0})},e.checkSearch=function(){void 0!==t.localStorage.search&&(e.data={search:t.localStorage.search},r.searchFile(t.localStorage.search).success(function(o,t,r,n){e.results=o}).error(function(o,t,r,n){e.err=!0}),t.localStorage.clear())}}).controller("RegistryDetailsController",function(e,o,t,r,n){n.getFileWithId(r.registryId).success(function(o,t,r,i){e.data=o,n.getYAMLFile(o._id,o.projectName,o.path).success(function(o,t,r,n){e.composeFile=o,e.loaded=!0}).error(function(o,t,r,n){e.composeFile="Unable to fetch tutum.yml from Github repository. Please select a repository that contains a tutum.yml or a docker-compose.yml file",e.loaded=!0})}).error(function(e,o,t,r){window.location.href="/404"}),o.logged&&(e.user=o.user,e.logged=o.logged),e.showModal=!1,e.toggleModal=function(){e.showModal=!e.showModal},e.generateEmbed=function(o){e.embedScript='<script src="'+window.location.protocol+"//"+window.location.hostname+"/embed/file/"+o+'.js"></script>'},e.deploy=function(e){window.location.href="/api/v1/deploy/"+e},e.toggleStatus=function(o){e.favoriteList.push(o._id),n.favFile(o._id).success(function(e,o,t,r){}).error(function(o,t,r,n){e.err=!0})},e.isSelected=function(o){return e.favoriteList.indexOf(o._id)>-1},e.deleteStackfile=function(o){n.deleteStackfile(o).success(function(e,o,r,n){t.location.href="/registry"}).error(function(o,t,r,n){e.err=!0})}}).controller("CreateController",function(e,o,t,r){o.logged&&(e.user=o.user,e.logged=o.logged),e.getOrgs=function(){var o=[];e.stackfile="Window will automatically refresh after filling form.",r.getUserOrgs().success(function(t,r,n,i){angular.forEach(t,function(e,t){o.push(e.login)}),o.push(e.user),e.orgs=o}).error(function(o,t,r,n){e.err=!0})},e.getRepos=function(){var o=[];e.data.path="/",e.stackfile="Window will automatically refresh after filling form.",r.getUserRepos(e.data.orgname).success(function(t,r,n,i){e.repos=[],angular.forEach(t,function(e,t){o.push(e.name)}),e.repos=o}).error(function(o,t,r,n){e.err=!0})},e.getBranches=function(){var o=[];e.data.path="/",e.stackfile="Window will automatically refresh after filling form.",null!==e.data.reponame&&(e.branches=[],r.getRepoBranches(e.data.orgname,e.data.reponame).success(function(t,r,n,i){angular.forEach(t,function(e,t){o.push(e)}),e.branches=o}).error(function(o,t,r,n){e.err=!0}))},e.locked=!1,e.getComposeFile=function(o,t,n,i){e.stackfile="",r.getUserReposInfo(o,t,n,i).success(function(o,t,r,n){"File not found"===o?(e.stackfile="Unable to fetch tutum.yml from Github repository. Please select a repository that contains a tutum.yml or a docker-compose.yml file",e.locked=!0):(e.locked=!1,e.stackfile=o)}).error(function(o,t,r,n){e.err=!0})},e.createNew=function(){var o=this.data.title,n=jsyaml.load(e.stackfile),i=this.data.branch,c=this.data.path,s=this.data.reponame,a=this.data.orgname,l=this.data.description,u={title:o.replace(/[^a-zA-Z0-9]/g," "),stackfile:n,branch:i,path:c,name:s,orgname:a,description:l};r.saveFile(u).success(function(e,o,r,n){t.location.href="/registry"}).error(function(e,o,t,r){window.location.href="/404"})}});